<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8" />
    <title>abba23 - Mini Python no Browser + IA local</title>

    <style>
        body {
            background: #f4f4f4;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
        }

        python {
            display: block;
            background: #ffffff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        python div {
            text-align: left;
            width: 100%;
        }

        h1 { color: #3776ab; }
        h2 { color: purple; }
        h3 { color: orange; text-align: center; }
        b  { color: #ff9900; }

        img {
            display: inline-block;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        canvas {
            margin-top: 10px;
            border-radius: 10px;
            background: #ffffff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
        }

        .error-box {
            color: red;
            border: 1px solid red;
            padding: 5px;
            border-radius: 6px;
            background: #ffecec;
            margin-top: 5px;
        }
    </style>
</head>

<body>
    <h1>linguagem programa√ß√£o abba23 + IA local</h1>

    <!-- BLOCO 1 -->
    <python>
print("Ol√° pessoa")

def printMessage(n):
    for i in range(n):
        print("Python magic!")

printMessage(3)
    </python>

    <!-- BLOCO 2 -->
    <python>
nome = "Super Calculadora"
print("<h1>" + nome + "</h1>")

a = 500
b = 250
resultado = a + b

print("<p>A soma de <b>", a, "</b> com <b>", b, "</b> √©:</p>")
print("<h2>", resultado, "</h2><br>")
print(23 * 45)
print("<br>Eu sou a maria")
print("<br><h3>Deus Jesus em poesis Maria</h3>")
print('<img src="https://img.freepik.com/foto-gratis/nina-oracion-concepto-paz-esperanza-suenos_78949-114.jpg?size=626&amp;ext=jpg" width="500px"><br>')
print("O CSS DESTE CODIGO DEVE sempre inserir a div python no css")
    </python>
<python>
print('<div style="color:green;"><img src="https://lucerospeaks.com/wp-content/uploads/2022/09/11062b_34fec81cfff546ca9b35112e3347fe43mv2.webp"width="70%"></div><br><h1 style="color:orange;">JESUS DEUS MARIA<br>Gratidao mudamos o mundo</h1>')

</python>
    <!-- BLOCO 3 -->
    <python>
print("ol√° mundo")

cars = ["Ford", "Volvo", "BMW"]
print("Lista de carros:", cars)
print("Segundo carro:", cars[1])

x = 0
while x < 3:
    print("x =", x)
    x = x + 1

for i in range(3):
    print("i em range(3):", i)

for j in range(2, 7, 2):
    print("j em range(2,7,2):", j)

def soma(a, b):
    resultado = a + b
    return resultado

print("Soma 10 + 20 =", soma(10, 20))

valor = 7
if valor < 5:
    print("Valor √© pequeno")
elif valor < 10:
    print("Valor √© m√©dio")
else:
    print("Valor √© grande")

ligado = True
desligado = False
condicao = (10 > 5) and not False
print("Estado ligado:", ligado, "desligado:", desligado, "condi√ß√£o l√≥gica:", condicao)

pessoa = {"nome": "Maria", "idade": 30}
print("Pessoa:", pessoa)

nome = "Abba"
print("len(cars) =", len(cars))
print("len(nome) =", len(nome))

texto = """
Isto √© uma string
multilinha em pseudo-Python,
convertida para template literal em JS.
"""
print(texto)
    </python>

    <!-- BLOCO 4: GR√ÅFICOS -->
    <python>
import graficos

print("<h2>Gr√°fico de Linha</h2>")
dados = [10, 20, 15, 30, 25, 40]
graficos.plot_line(dados, "Crescimento ao longo do tempo")

print("<h2>Gr√°fico de Barras</h2>")
categorias = ["A", "B", "C", "D"]
valores = [5, 12, 8, 15]
graficos.plot_bar(categorias, valores, "Compara√ß√£o de categorias")

print("<h2>Gr√°fico de Pizza</h2>")
graficos.plot_pizza(["Ma√ß√£","Banana","Cereja","Laranja"], [30,20,25,25], "Frutas")
    </python>

    <!-- BLOCO 5: YOUTUBE -->
    <python>
print("<h2>Abba o meu objetivo de vida</h2>")

print('<iframe width="510" height="384" src="https://www.youtube.com/embed/8tE0GjSQpes?list=RD8tE0GjSQpes" frameborder="0" allowfullscreen></iframe>')

print('EVITAR O COMFLITO ASPAS NO python html')
    </python>

    <!-- BLOCO 6: TESTE DO M√ìDULO timedate -->
    <python>
import timedate

print("Agora:", timedate.now())
print("Data:", timedate.date())
print("Hora:", timedate.time())
print("Ano:", timedate.year())
print("M√™s:", timedate.month())
print("Dia:", timedate.day())
    </python>

    <!-- BLOCO 7: TESTE random -->
    <python>
import random

print("N√∫mero aleat√≥rio:", random.random())
print("Inteiro entre 1 e 10:", random.randint(1,10))
print("Escolha:", random.choice(["A","B","C","D"]))
    </python>

    <!-- BLOCO 8: TESTE math -->
    <python>
import math

print("Raiz de 81 =", math.sqrt(81))
print("PI =", math.pi)
print("Seno de 1 =", math.sin(1))
    </python>

    <!-- BLOCO 9: TESTE IA LOCAL EM PYTHON -->
    <python>
import ai

print("<h2>IA local em abba23 (modo Python)</h2>")

resposta1 = ai.complete("Jesus, f√©, tecnologia e humanidade")
print("Completar:", resposta1)

resposta2 = ai.reflect("Sinto que estamos a criar algo novo.")
print("Reflex√£o:", resposta2)

resumo = ai.summarize("A linguagem abba23 permite escrever c√≥digo Python-like diretamente em HTML e agora tamb√©m falar com uma IA local.")
print("Resumo:", resumo)
    </python>

    <!-- INTERFACE HTML PARA FALAR COM A IA DIRETAMENTE -->
    <h2>Chat com IA local (modo HTML)</h2>

    <div style="background:#fff;padding:15px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1);margin-bottom:20px;">
        <input id="ia_input" type="text" placeholder="Escreve algo para a IA..." 
               style="width:80%;padding:10px;border-radius:6px;border:1px solid #ccc;">
        <button onclick="iaEnviar()" 
                style="padding:10px 20px;border:none;background:#3776ab;color:white;border-radius:6px;cursor:pointer;">
            Enviar
        </button>

        <div id="ia_output" style="margin-top:15px;font-size:1.1em;"></div>
    </div>

    <script>
/* ============================
   CONTEXTO GLOBAL / M√ìDULOS
============================ */

let currentPythonTag = null;
const pythonModules = {};

/* ============================
   FUN√á√ïES AUXILIARES
============================ */

function splitArgsRespectingContext(argString) {
    const result = [];
    let current = "";

    let inSingle = false;
    let inDouble = false;
    let parenDepth = 0;   // ()
    let bracketDepth = 0; // []
    let braceDepth = 0;   // {}

    for (let i = 0; i < argString.length; i++) {
        const ch = argString[i];

        // strings
        if (ch === "'" && !inDouble) {
            inSingle = !inSingle;
            current += ch;
            continue;
        }
        if (ch === '"' && !inSingle) {
            inDouble = !inDouble;
            current += ch;
            continue;
        }

        // dentro de string: tudo √© literal
        if (inSingle || inDouble) {
            current += ch;
            continue;
        }

        // controlo de (), [], {}
        if (ch === "(") { parenDepth++; current += ch; continue; }
        if (ch === ")") { parenDepth--; current += ch; continue; }
        if (ch === "[") { bracketDepth++; current += ch; continue; }
        if (ch === "]") { bracketDepth--; current += ch; continue; }
        if (ch === "{") { braceDepth++; current += ch; continue; }
        if (ch === "}") { braceDepth--; current += ch; continue; }

        // v√≠rgula s√≥ conta se n√£o estivermos dentro de par√™nteses/colchetes/chaves
        if (
            ch === "," &&
            parenDepth === 0 &&
            bracketDepth === 0 &&
            braceDepth === 0
        ) {
            if (current.trim().length > 0) result.push(current.trim());
            current = "";
            continue;
        }

        current += ch;
    }

    if (current.trim().length > 0) result.push(current.trim());
    return result;
}

function convertMultilineStrings(code) {
    return code.replace(/"""\s*([\s\S]*?)\s*"""/g, (match, inner) => {
        const safeInner = inner.replace(/`/g, "\\`");
        return "`" + safeInner + "`";
    });
}

function convertLenCalls(code) {
    return code.replace(/\blen\(([^)]+)\)/g, (match, inside) => {
        return "(" + inside.trim() + ").length";
    });
}

/* ============================
   TRANSPILER PYTHON ‚Üí JS
============================ */

function transpilePythonToJS(code) {
    code = code.replace(/&lt;/g, "<").replace(/&gt;/g, ">");
    code = convertMultilineStrings(code);
    code = convertLenCalls(code);

    code = code
        .replace(/\bTrue\b/g, "true")
        .replace(/\bFalse\b/g, "false")
        .replace(/\band\b/g, "&&")
        .replace(/\bor\b/g, "||")
        .replace(/\bnot\b/g, "!");

    const lines = code.split("\n");
    const out = [];
    const indentStack = [];

    function closeBlocks(currentIndent) {
        while (indentStack.length > 0 && indentStack[indentStack.length - 1] >= currentIndent) {
            indentStack.pop();
            out.push("}");
        }
    }

    for (let raw of lines) {
        const line = raw.replace(/\t/g, "    ");
        const trimmed = line.trim();

        if (trimmed === "") {
            out.push("");
            continue;
        }

        const indent = line.match(/^ */)[0].length;

        // coment√°rios
        if (trimmed.startsWith("#")) {
            out.push("// " + trimmed.slice(1));
            continue;
        }

        // import modulo
        if (trimmed.startsWith("import ")) {
            const moduleName = trimmed.replace("import", "").trim();
            out.push(`const ${moduleName} = __import__("${moduleName}");`);
            continue;
        }

        // print(...)
        if (trimmed.startsWith("print(") && trimmed.endsWith(")")) {
            const argsInside = trimmed.slice(6, -1);
            const args = splitArgsRespectingContext(argsInside);
            const jsArgs = args.map(arg => {
                if (arg.startsWith('"') || arg.startsWith("'") || arg.startsWith("`")) {
                    return arg;
                }
                return `String(${arg})`;
            });
            out.push("print(" + jsArgs.join(' + \" \" + ') + ");");
            continue;
        }

        // def ...
        if (trimmed.startsWith("def ") && trimmed.endsWith(":")) {
            closeBlocks(indent);
            const match = trimmed.match(/^def\s+([a-zA-Z_]\w*)\((.*?)\):$/);
            if (match) {
                const name = match[1];
                const params = match[2];
                out.push(`function ${name}(${params}) {`);
                indentStack.push(indent);
                continue;
            }
        }

        // while ...
        if (trimmed.startsWith("while ") && trimmed.endsWith(":")) {
            closeBlocks(indent);
            const condition = trimmed.slice(6, -1).trim();
            out.push(`while (${condition}) {`);
            indentStack.push(indent);
            continue;
        }

        // for i in range(...)
        if (trimmed.startsWith("for ") && trimmed.endsWith(":")) {
            closeBlocks(indent);
            const match = trimmed.match(/^for\s+([a-zA-Z_]\w*)\s+in\s+range\((.*?)\):$/);
            if (match) {
                const varName = match[1];
                const args = splitArgsRespectingContext(match[2]);
                let start = "0", end = "0", step = "1";

                if (args.length === 1) end = args[0];
                else if (args.length === 2) { start = args[0]; end = args[1]; }
                else if (args.length === 3) { start = args[0]; end = args[1]; step = args[2]; }

                out.push(
`for (let ${varName} = ${start}; (${step} >= 0 ? ${varName} < ${end} : ${varName} > ${end}); ${varName} += ${step}) {`
                );
                indentStack.push(indent);
                continue;
            }
        }

        // if / elif / else
        if (trimmed.startsWith("if ") && trimmed.endsWith(":")) {
            closeBlocks(indent);
            const condition = trimmed.slice(3, -1).trim();
            out.push(`if (${condition}) {`);
            indentStack.push(indent);
            continue;
        }

        if (trimmed.startsWith("elif ") && trimmed.endsWith(":")) {
            closeBlocks(indent);
            const condition = trimmed.slice(5, -1).trim();
            out.push(`else if (${condition}) {`);
            indentStack.push(indent);
            continue;
        }

        if (trimmed === "else:") {
            closeBlocks(indent);
            out.push("else {");
            indentStack.push(indent);
            continue;
        }

        // return
        if (trimmed.startsWith("return ")) {
            const expr = trimmed.slice(7).trim();
            out.push(`return ${expr};`);
            continue;
        }

        // atribui√ß√£o simples
        if (!trimmed.startsWith("<") && trimmed.includes("=")) {
            const match = trimmed.match(/^([a-zA-Z_]\w*)\s*=\s*(.+)$/);
            if (match) {
                closeBlocks(indent);
                const name = match[1];
                const expr = match[2];
                out.push(`let ${name} = ${expr};`);
                continue;
            }
        }

        // linha "crua"
        closeBlocks(indent);
        out.push(trimmed);
    }

    closeBlocks(0);
    return out.join("\n");
}

/* ============================
   M√ìDULO DE GR√ÅFICOS
============================ */

function createPlotHelpers(tag) {

    function createCanvas(title) {
        const container = document.createElement("div");
        container.style.marginTop = "10px";

        if (title) {
            const h = document.createElement("div");
            h.innerHTML = `<strong>${title}</strong>`;
            container.appendChild(h);
        }

        const canvas = document.createElement("canvas");
        canvas.width = 500;
        canvas.height = 250;
        container.appendChild(canvas);
        tag.appendChild(container);

        return canvas.getContext("2d");
    }

    function plot_line(data, title) {
        if (!Array.isArray(data) || data.length === 0) return;
        const ctx = createCanvas(title);

        const w = ctx.canvas.width;
        const h = ctx.canvas.height;
        const margin = 30;

        const max = Math.max(...data);
        const min = Math.min(...data);
        const range = (max - min) || 1;

        ctx.clearRect(0, 0, w, h);
        ctx.strokeStyle = "#333";
        ctx.lineWidth = 1;

        ctx.beginPath();
        ctx.moveTo(margin, margin);
        ctx.lineTo(margin, h - margin);
        ctx.lineTo(w - margin, h - margin);
        ctx.stroke();

        ctx.strokeStyle = "#3776ab";
        ctx.lineWidth = 2;
        ctx.beginPath();

        data.forEach((val, i) => {
            const x = margin + (i / (data.length - 1 || 1)) * (w - 2 * margin);
            const y = h - margin - ((val - min) / range) * (h - 2 * margin);
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        });

        ctx.stroke();
    }

    function plot_bar(labels, values, title) {
        if (!Array.isArray(labels) || !Array.isArray(values)) return;
        if (labels.length === 0 || values.length === 0) return;

        const ctx = createCanvas(title);

        const w = ctx.canvas.width;
        const h = ctx.canvas.height;
        const margin = 30;

        const max = Math.max(...values);
        const range = max || 1;

        ctx.clearRect(0, 0, w, h);

        ctx.strokeStyle = "#333";
        ctx.beginPath();
        ctx.moveTo(margin, h - margin);
        ctx.lineTo(w - margin, h - margin);
        ctx.stroke();

        const barWidth = (w - 2 * margin) / values.length * 0.7;
        const gap = (w - 2 * margin) / values.length * 0.3;

        values.forEach((val, i) => {
            const x = margin + i * (barWidth + gap) + gap / 2;
            const barHeight = (val / range) * (h - 2 * margin);
            const y = h - margin - barHeight;

            ctx.fillStyle = "#ff9900";
            ctx.fillRect(x, y, barWidth, barHeight);

            ctx.fillStyle = "#000";
            ctx.font = "12px Segoe UI";
            ctx.textAlign = "center";
            ctx.fillText(labels[i], x + barWidth / 2, h - margin + 15);
        });
    }

    function plot_pizza(labels, values, title) {
        if (!Array.isArray(labels) || !Array.isArray(values)) return;
        if (labels.length === 0 || values.length === 0) return;

        const ctx = createCanvas(title || "Gr√°fico de Pizza");
        const w = ctx.canvas.width;
        const h = ctx.canvas.height;
        const radius = Math.min(w, h) / 2 - 20;
        const centerX = w / 2;
        const centerY = h / 2;

        const total = values.reduce((a, b) => a + b, 0);
        let startAngle = 0;

        const colors = [
            "#ff6384", "#36a2eb", "#ffcd56",
            "#4bc0c0", "#9966ff", "#ff9f40"
        ];

        values.forEach((val, i) => {
            const sliceAngle = (val / total) * Math.PI * 2;
            const endAngle = startAngle + sliceAngle;

            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.fillStyle = colors[i % colors.length];
            ctx.arc(centerX, centerY, radius, startAngle, endAngle);
            ctx.closePath();
            ctx.fill();

            const midAngle = startAngle + sliceAngle / 2;
            const labelX = centerX + Math.cos(midAngle) * (radius * 0.65);
            const labelY = centerY + Math.sin(midAngle) * (radius * 0.65);

            ctx.fillStyle = "#000";
            ctx.font = "14px Segoe UI";
            ctx.textAlign = "center";
            ctx.fillText(labels[i], labelX, labelY);

            startAngle = endAngle;
        });
    }

    return { plot_line, plot_bar, plot_pizza };
}

// registar m√≥dulo "graficos"
pythonModules.graficos = function(tag) {
    return createPlotHelpers(tag);
};

/* ============================
   M√ìDULO timedate
============================ */

pythonModules.timedate = function(tag) {
    return {
        now: function() {
            return new Date().toLocaleString();
        },
        date: function() {
            return new Date().toLocaleDateString();
        },
        time: function() {
            return new Date().toLocaleTimeString();
        },
        year: function() {
            return new Date().getFullYear();
        },
        month: function() {
            return new Date().getMonth() + 1;
        },
        day: function() {
            return new Date().getDate();
        }
    };
};

/* ============================
   M√ìDULO random
============================ */

pythonModules.random = function(tag) {
    return {
        random: function() {
            return Math.random();
        },
        randint: function(a, b) {
            a = Math.floor(a);
            b = Math.floor(b);
            return a + Math.floor(Math.random() * (b - a + 1));
        },
        choice: function(arr) {
            if (!Array.isArray(arr) || arr.length === 0) return null;
            return arr[Math.floor(Math.random() * arr.length)];
        }
    };
};

/* ============================
   M√ìDULO math
============================ */

pythonModules.math = function(tag) {
    return {
        pi: Math.PI,
        e: Math.E,
        sqrt: Math.sqrt,
        sin: Math.sin,
        cos: Math.cos,
        tan: Math.tan,
        pow: Math.pow,
        abs: Math.abs,
        floor: Math.floor,
        ceil: Math.ceil
    };
};

/* ============================
   M√ìDULO IA LOCAL (ai)
============================ */

pythonModules.ai = function(tag) {

    function randomChoice(list) {
        return list[Math.floor(Math.random() * list.length)];
    }

    function scoreKeywords(text, keywords) {
        text = (text || "").toLowerCase();
        return keywords.reduce((acc, k) => acc + (text.includes(k) ? 1 : 0), 0);
    }

    function complete(prompt) {
        const p = (prompt || "").trim();

        const espiritual = ["deus","jesus","maria","f√©","alma","ora√ß√£o"];
        const tecnologia = ["c√≥digo","programa√ß√£o","html","python","ia","algoritmo"];
        const humano = ["vida","humanidade","cora√ß√£o","pessoas","dor","alegria","amor"];

        const sEsp = scoreKeywords(p, espiritual);
        const sTec = scoreKeywords(p, tecnologia);
        const sHum = scoreKeywords(p, humano);

        const baseInicio = randomChoice([
            "H√° algo profundo nisto:",
            "Se pensarmos com calma, percebemos que",
            "Em sil√™ncio, √© como se o cora√ß√£o dissesse:",
            "√Ä primeira vista parece simples, mas na verdade",
            "Quando olhamos com f√© e aten√ß√£o,"
        ]);

        let corpo;
        if (sEsp >= sTec && sEsp >= sHum) {
            corpo = randomChoice([
                " a f√© n√£o √© contra a raz√£o, √© a luz que atravessa a raz√£o e d√° sentido ao que fazemos.",
                " Deus n√£o apaga o humano, Ele eleva o humano a algo maior do que os nossos medos.",
                " Jesus entra exatamente onde nos sentimos fracos e mostra que a fragilidade n√£o √© o fim, √© o come√ßo.",
                " Maria lembra-nos que dizer 'sim' ao mist√©rio muda a hist√≥ria inteira, mesmo que ningu√©m veja na hora."
            ]);
        } else if (sTec >= sEsp && sTec >= sHum) {
            corpo = randomChoice([
                " a tecnologia √© s√≥ uma extens√£o do cora√ß√£o humano: amplifica aquilo que j√° trazemos por dentro.",
                " o c√≥digo √© uma forma de ora√ß√£o l√≥gica: pegamos no caos e organizamo-lo em algo que cria vida.",
                " a IA n√£o substitui ningu√©m; apenas espelha padr√µes. O que muda o mundo ainda √© a consci√™ncia de quem a usa.",
                " cada linha de HTML, Python ou abba23 √© uma pequena tentativa de p√¥r ordem no universo √† nossa volta."
            ]);
        } else {
            corpo = randomChoice([
                " a humanidade √© este conflito entre medo e desejo de amar, e √© exatamente a√≠ que crescemos.",
                " ningu√©m sabe realmente o que est√° a fazer, estamos todos a aprender pelo caminho e isso √© mais honesto do que fingir controlo.",
                " √†s vezes o que parece fraqueza √©, na verdade, a parte mais verdadeira de n√≥s a pedir espa√ßo.",
                " a vida n√£o √© um projeto perfeito, √© uma sucess√£o de rascunhos onde, de vez em quando, algo fica bonito."
            ]);
        }

        const final = randomChoice([
            " E talvez seja precisamente isso que precisamos aceitar hoje.",
            " No fundo, √© a√≠ que come√ßamos a ser realmente honestos connosco.",
            " E isso n√£o √© pouco. Isso j√° √© um milagre discreto.",
            " E se deixarmos, essa compreens√£o come√ßa mesmo a mudar a forma como vivemos."
        ]);

        return baseInicio + corpo + final;
    }

    function reflect(text) {
        const t = (text || "").trim();
        if (!t) {
            return "Quando n√£o h√° palavras, o sil√™ncio j√° √© uma resposta. √Äs vezes basta reconhec√™-lo.";
        }

        return randomChoice([
            "O que est√°s a dizer carrega mais peso do que parece. H√° uma parte de ti que j√° percebeu isso.",
            "Sinto que, por detr√°s dessa frase, h√° cansa√ßo e esperan√ßa ao mesmo tempo. As duas coisas podem coexistir.",
            "Talvez o que estejas a tentar dizer √© que h√° algo a nascer dentro de ti, mas ainda n√£o tens vocabul√°rio para isso.",
            "√Äs vezes o que escrevemos √© s√≥ a superf√≠cie. O que realmente importa √© o que te fez precisar de escrever isto."
        ]);
    }

    function summarize(text) {
        const t = (text || "").trim();
        if (t.length < 40) {
            return "√â uma ideia simples, mas com potencial para crescer se lhe deres espa√ßo.";
        }

        return randomChoice([
            "Resumo: est√°s a tentar juntar cria√ß√£o t√©cnica com algo mais profundo e humano.",
            "Resumo: h√° um movimento de trazer vida para dentro do c√≥digo, como se o HTML fosse s√≥ o corpo e tu estivesses a cuidar da alma.",
            "Resumo: o projeto √© uma ponte entre programa√ß√£o, f√© e humanidade.",
            "Resumo: est√°s a construir algo pequeno por fora, mas grande por dentro."
        ]);
    }

    function chat(text) {
        const r = Math.random();
        if (r < 0.33) return complete(text);
        if (r < 0.66) return reflect(text);
        return summarize(text);
    }

    return {
        complete,
        reflect,
        summarize,
        chat
    };
};

/* ============================
   IMPORT REAL
============================ */

function __import__(name) {
    if (!currentPythonTag) {
        throw new Error("Import chamado fora de um bloco python");
    }

    if (!(name in pythonModules)) {
        throw new Error("M√≥dulo n√£o encontrado: " + name);
    }

    return pythonModules[name](currentPythonTag);
}

/* ============================
   INTERFACE HTML COM A IA
============================ */

function iaEnviar() {
    const texto = document.getElementById("ia_input").value.trim();
    if (!texto) return;

    const resposta = pythonModules.ai(null).chat(texto);
    document.getElementById("ia_output").innerHTML = resposta;
}

/* ============================
   EXECU√á√ÉO DOS <python>
============================ */

async function bootstrapPython() {
    const pythonTags = document.querySelectorAll("python");

    for (const tag of pythonTags) {
        currentPythonTag = tag;

        let code = tag.innerHTML.trim();
        tag.innerHTML = "";

        const print = (...args) => {
            const output = args.join(" ");
            const div = document.createElement("div");
            div.innerHTML = output;
            tag.appendChild(div);
        };

        try {
            const js = transpilePythonToJS(code);

            const runner = new Function(
                "print",
                "__import__",
                `(async()=>{${js}})()`
            );

            await runner(print, __import__);

        } catch (err) {
            tag.innerHTML = `<div class="error-box">
                <b>Erro:</b> ${err.message}
            </div>`;
        }

        currentPythonTag = null;
    }
}

window.addEventListener("load", bootstrapPython);
    </script>

</body>
</html>
<#########################IA CEGONHA NOVO CODIGO###############################>
<div><html>
<meta charset="utf-8">
<head>
<title>IA Cegonha Evolutiva 9.0 üåøüïäÔ∏è</title>
<style>
  body { margin: 0; background-color: #f0f8ff; font-family: Arial; display: flex; flex-direction: column; align-items: center; }
  #container { position: relative; width: 100%; height: 50vh; border: 1px solid #ccc; margin-top: 20px; overflow: hidden; }
  #input-container { margin-top: 20px; text-align: center; width: 90%; max-width: 700px; }
  #user-input { padding: 10px; width: 70%; border-radius: 8px; font-size: 16px; }
  #ask-button { padding: 10px 20px; margin-left: 10px; font-size: 16px; }
  #response { margin-top: 20px; width: 100%; font-size: 18px; color: #333; padding: 15px; background: #ffffffd0; border-radius: 10px; min-height: 80px; }
  canvas { border: 1px solid #999; background: #f9f9ff; width: 100%; height: 100%; }
  #audio-controls { margin-top: 10px; display:flex; gap:10px; align-items:center; justify-content:center; }
  #stork-response-container { text-align:center; margin-top:10px; }
  .flowers { font-size: 24px; line-height: 1.6; }
</style>

</head>
</body>
<h1>Cegonha Evolutiva 9.0</h1>

<div style="position: relative; width: 100%; text-align: center; margin: 10px 0; font-family: 'Georgia', serif;">
  <div style="font-size: 14px; color: #555; margin-bottom: 6px;">
    Cegonha IA ‚Äî a arte, a espiritualidade, a poesia e o amor juntos na alma
  </div>
  <!-- Flores substituindo imagem -->
  <div class="flowers">üå∏üåºüå∫üåªüåπüå∑</div>
</div>

<div id="container">
  <canvas id="brainCanvas"></canvas>
  <!-- Flores substituindo imagem da cegonha -->
  <div class="flowers" aria-hidden="true">üå∏üåºüå∫üåªüåπüå∑</div>
</div>

<div id="input-container">
  <input id="user-input" type="text" placeholder="Escreva algo...">
  <button id="ask-button">Perguntar</button>
  <div id="response"></div>

  <!-- Flores substituindo cegonha clic√°vel -->
  <div id="stork-response-container">
    <p>Raciocinio da Cegonha! Clica em mim.<br>
      <button id="stork-response" style="cursor:pointer">üå∏üåºüå∫üåªüåπüå∑</button>
    </p>
  </div>

  <div id="audio-controls">
    <button id="play-audio">‚ñ∂Ô∏è Iniciar M√∫sica</button>
    <button id="pause-audio">‚è∏Ô∏è Parar M√∫sica</button>
    <label for="volume-control">üîä Volume</label>
    <input type="range" id="volume-control" min="0" max="1" step="0.01" value="0.5">
  </div>
</div>

<!-- √Åudio espiritual longo e suave (HTTPS) -->
<audio id="stork-audio" loop preload="metadata">
  <!-- Este arquivo √© longo, instrumental e suave (adequado para medita√ß√£o) -->
  <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
  Seu navegador n√£o suporta √°udio.
</audio>

<script>
/**********************
  ELEMENTOS
***********************/
const canvas = document.getElementById("brainCanvas");
const ctx = canvas.getContext("2d");
const userInput = document.getElementById("user-input");
const askButton = document.getElementById("ask-button");
const responseDiv = document.getElementById("response");
const container = document.getElementById("container");
canvas.width = container.clientWidth;
canvas.height = container.clientHeight;

const audio = document.getElementById("stork-audio");
document.getElementById("play-audio").addEventListener("click", () => audio.play());
document.getElementById("pause-audio").addEventListener("click", () => { audio.pause(); audio.currentTime = 0; });
document.getElementById("volume-control").addEventListener("input", (e) => { audio.volume = e.target.value; });

let lastQuestion = "";
let memory = [];

/**********************
  DADOS ORIGINAIS
***********************/
const energyColors = ["dourado","azul celeste","violeta m√≠stico","verde cura","prateado lunar","rosa suave","laranja criativo","turquesa espiritual","√≠ndigo profundo","vermelho ancestral"];
const archetypes = ["A Crian√ßa Sagrada","O Curandeiro Interior","A Luz Oculta","O Guardi√£o da Porta","A Voz Silenciosa","O Sonhador Desperto","O Cora√ß√£o Antigo","A Semente Estelar"];
const symbolicVisions = ["um lago espelhado com respostas escondidas","uma chama pequena mas persistente no peito","um corredor entre luz e sombra","uma ponte suspensa entre duas nuvens antigas","um jardim onde emo√ß√µes crescem como flores","um rio que muda de cor quando pensa","uma estrela a piscar no ritmo do seu cora√ß√£o"];
const narrativeLines = ["Era uma vez, nas alturas onde o vento guarda segredos, uma pergunta despertou asas de luz‚Ä¶","Recordo-me de uma manh√£ celestial em que uma alma curiosa fez algo parecido ao que perguntaste agora‚Ä¶","H√° muito tempo, nas primeiras nuvens do amanhecer espiritual, ouvi um eco parecido ao da tua pergunta‚Ä¶","Numa viagem entre mundos, encontrei um brilho semelhante ao que existe nas tuas palavras‚Ä¶"];
const stopwords = ["a","o","as","os","um","uma","de","da","do","das","dos","em","no","na","nos","nas","ao","√†","h√°","faz","verso","um","uma","sobre","para","por","e","ou","se","que"];

/**********************
  EMO√á√ïES
***********************/
function detectEmotion(text){
  const lower = text.toLowerCase();
  if(lower.includes("medo")||lower.includes("ansioso")||lower.includes("preocup")) return "uma leve inquieta√ß√£o no seu cora√ß√£o";
  if(lower.includes("feliz")||lower.includes("bom")||lower.includes("alegre")) return "uma luz quente e alegre nas suas palavras";
  if(lower.includes("triste")||lower.includes("dor")||lower.includes("perdido")) return "uma sombra suave, como quem busca conforto";
  return "uma energia curiosa a querer entender mais";
}

/**********************
  BRAIN & MEM√ìRIA
***********************/
let cegonhaBrain = { words:{}, concepts:{}, links:[], maturity:0, evolutionLog:[] };
if(localStorage.getItem("cegonhaBrain")){ try{ cegonhaBrain = JSON.parse(localStorage.getItem("cegonhaBrain")); }catch(e){} }

let wordVerses = JSON.parse(localStorage.getItem("wordVersesMemory")) || {
  "benfica":["Nos campos do nosso cora√ß√£o, o Benfica brilha, com a paix√£o que nunca se esvazia.","Na vit√≥ria ou na dor, o Benfica √© amor, sempre a brilhar na nossa mem√≥ria."],
  "amor":["O amor √© a luz que ilumina o caminho, em cada passo, um carinho.","Como flores que brotam no ver√£o, o amor cresce no cora√ß√£o."],
  "esperan√ßa":["A esperan√ßa √© um sol que nunca se apaga, mesmo nas noites mais escuras, ela se propaga."]
};
function saveVerseMemory(){ localStorage.setItem("wordVersesMemory", JSON.stringify(wordVerses)); }

function readEnergy(q){
  return {
    color: energyColors[Math.floor(Math.random()*energyColors.length)],
    archetype: archetypes[Math.floor(Math.random()*archetypes.length)],
    vision: symbolicVisions[Math.floor(Math.random()*symbolicVisions.length)],
    emotion: detectEmotion(q)
  };
}
function narrative(){ return narrativeLines[Math.floor(Math.random()*narrativeLines.length)]; }
function cegonhaDeepThought(){ return "üí≠ Aqui est√° um pensamento profundo para voc√™ considerar..."; }

/**********************
  VERSOS INFINITOS & √öNICOS
***********************/
function generateInfiniteVerse(word){
  const starts = ["Quando penso em", "Nos cantos do vento vive", "Em noites silenciosas surge","Sob o brilho das estrelas desperta","No cora√ß√£o do tempo vibra","Entre sonhos ocultos dan√ßa","Nos ecos do universo canta"];
  const middles = ["um brilho que ningu√©m consegue apagar","uma mem√≥ria que respira vida","um toque suave que se entranha na alma","uma for√ßa que renasce lentamente","uma hist√≥ria que insiste em ser contada"];
  const ends = ["e o mundo parece mais leve.","e tudo encontra um novo significado.","e a alma sorri em sil√™ncio.","e nasce um novo caminho.","e tudo volta a florescer."];
  return `${starts[Math.random()*starts.length|0]} ${word}, ${middles[Math.random()*middles.length|0]} ${ends[Math.random()*ends.length|0]}`;
}

function getUniqueVerse(word){
  if(!wordVerses[word]) return null;
  if(!window.verseHistory) window.verseHistory = {};
  if(!window.verseHistory[word]) window.verseHistory[word] = [];
  const options = wordVerses[word].filter(v => !window.verseHistory[word].includes(v));
  let chosen = options.length>0 ? options[Math.random()*options.length|0] : wordVerses[word][Math.random()*wordVerses[word].length|0];
  window.verseHistory[word].push(chosen);
  if(window.verseHistory[word].length>8) window.verseHistory[word].shift();
  return chosen;
}

/**********************
  GERADOR DE RESPOSTAS
***********************/
function generateResponse(question){
  const qLower = question.toLowerCase();
  const energy = readEnergy(question);
  const words = qLower.split(/[\s,.!?;:"()]+/g);

  let response = `<b>üïäÔ∏è Cegonha Evolutiva:</b><br><br>`;
  response += narrative() + "<br><br>";
  if(lastQuestion) response += `Recordo quando me falaste sobre ‚Äú${lastQuestion}‚Äù.<br><br>`;
  response += `Ao ouvir (‚Äú<i>${question}</i>‚Äù), senti ${energy.emotion}.<br><br>`;
  response += `Uma luz <b>${energy.color}</b> flu√≠a atrav√©s do arqu√©tipo <b>${energy.archetype}</b> que envolveu as tuas palavras.<br><br>`;
  response += `E visualizei <i>${energy.vision}</i>.<br><br>`;

  if(qLower.includes("faz um verso sobre") || qLower.includes("cria um verso sobre")){
    let target = qLower.replace("faz um verso sobre","").replace("cria um verso sobre","").trim();
    if(!stopwords.includes(target) && target.length>2){
      const auto = generateInfiniteVerse(target);
      if(!wordVerses[target]) wordVerses[target] = [];
      wordVerses[target].push(auto); saveVerseMemory();
      response += `<b>üåü Verso criado:</b> ‚Äú${auto}‚Äù<br><br>`;
    }
  }

  words.forEach(word=>{
    if(word.length<2) return;
    if(stopwords.includes(word)) return;
    if(wordVerses[word]){
      const unique = getUniqueVerse(word);
      if(unique) response += `<b>‚ú® Verso para "${word}":</b> ‚Äú${unique}‚Äù<br><br>`;
    }
  });

  words.forEach(word=>{
    if(word.length<3) return;
    if(stopwords.includes(word)) return;
    if(!wordVerses[word]){
      const learned = generateInfiniteVerse(word);
      wordVerses[word] = [learned]; saveVerseMemory();
      response += `<b>ü™∂ Nova palavra aprendida:</b> ‚Äú${word}‚Äù<br>‚Äú${learned}‚Äù<br><br>`;
    }
  });

  response += `üíñ A tua jornada importa.<br><br>` + cegonhaDeepThought();
  lastQuestion = question;
  return response;
}

/**********************
  C√âREBRO ANIMADO
***********************/
let nodes = {}; // palavra => {x,y,vx,vy,color}
let storkTarget = null;

function updateBrainNodes(){
  Object.keys(wordVerses).forEach(word=>{
    if(!nodes[word]){
      nodes[word] = {
        x: Math.random()*canvas.width, y: Math.random()*canvas.height,
        vx: (Math.random()-0.5)*0.5, vy: (Math.random()-0.5)*0.5,
        color: energyColors[Math.floor(Math.random()*energyColors.length)]
      };
    }
  });
  if(!storkTarget || Math.random()<0.005){
    const keys = Object.keys(nodes);
    if(keys.length) storkTarget = keys[Math.floor(Math.random()*keys.length)];
  }
}

function drawBrain(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  updateBrainNodes();

  Object.values(nodes).forEach(n=>{
    n.x += n.vx; n.y += n.vy;
    if(n.x<0||n.x>canvas.width) n.vx *= -1;
    if(n.y<0||n.y>canvas.height) n.vy *= -1;
  });

  const words = Object.keys(nodes);
  for(let i=0;i<words.length;i++){
    for(let j=i+1;j<words.length;j++){
      const n1 = nodes[words[i]], n2 = nodes[words[j]];
      const dx = n2.x-n1.x, dy = n2.y-n1.y, dist = Math.sqrt(dx*dx+dy*dy);
      if(dist<200){
        ctx.strokeStyle = `rgba(100,100,255,${0.2+Math.random()*0.3})`;
        ctx.lineWidth = 1+Math.random();
        ctx.beginPath(); ctx.moveTo(n1.x,n1.y); ctx.lineTo(n2.x,n2.y); ctx.stroke();
      }
    }
  }

  Object.keys(nodes).forEach(word=>{
    const n = nodes[word];
    ctx.beginPath();
    ctx.arc(n.x,n.y,6,0,2*Math.PI);
    ctx.fillStyle = n.color;
    ctx.fill();
    ctx.fillStyle = "#000"; ctx.font = "10px Arial"; ctx.fillText(word, n.x+8, n.y+4);
  });

  requestAnimationFrame(drawBrain);
}
drawBrain();

/**********************
  EVENTOS
***********************/
askButton.addEventListener("click", ()=>{
  const q = userInput.value.trim();
  if(!q) return;
  responseDiv.innerHTML = generateResponse(q);
  userInput.value = "";
});

// Bot√£o de ‚Äúcegonha‚Äù (flores) gera verso
const storkResponse = document.getElementById("stork-response");
storkResponse.addEventListener("click", () => {
  const keys = Object.keys(nodes);
  if(keys.length === 0) return;
  const word = keys[Math.floor(Math.random()*keys.length)];
  let verse = getUniqueVerse(word);
  if(!verse){
    verse = generateInfiniteVerse(word);
    wordVerses[word] = [verse];
    saveVerseMemory();
  }
  responseDiv.innerHTML += `<br><b>üïäÔ∏è Cegonha diz sobre "${word}":</b><br>‚Äú${verse}‚Äù<br><span class="flowers">üå∏üåºüå∫üåªüåπüå∑</span>`;
});

// Responsividade do canvas
window.addEventListener("resize", ()=>{
  canvas.width = container.clientWidth;
  canvas.height = container.clientHeight;
});
</script>
</body>

</html></div>

